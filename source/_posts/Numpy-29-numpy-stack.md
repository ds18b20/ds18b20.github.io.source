---
title: Numpy-29-numpy-stack
date: 2018-09-03 22:11:13
categories: Python
tags:
- Numpy
- stack

---

# Numpy.stack

numpy.stack(arrays, axis=0)实现沿着指定新轴axis连接多个序列arrays。

参数：

- arrays 需要合并的多个序列，要求序列拥有完全相同的shape
- axis 指定合并所沿轴的位置，要求int类型。axis=-1意味着最后一个纬度方向。
  返回：
  返回比输入序列增加了一个纬度的新序列。

## 用法

```
>>> import numpy as np
>>> a = np.array([1,2,3])
>>> b = np.array([4,5,6])
>>> a.shape
(3,)
>>> b.shape
(3,)
# 注意把多个序列外加到一个tuple内
>>> np.stack(a,b)
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "/anaconda3/lib/python3.6/site-packages/numpy/core/shape_base.py", line 356, in stack
    axis = normalize_axis_index(axis, result_ndim)
TypeError: only size-1 arrays can be converted to Python scalars
>>> np.stack((a,b))
array([[1, 2, 3],
       [4, 5, 6]])
>>> np.stack((a,b), axis=0)
array([[1, 2, 3],
       [4, 5, 6]])
>>> np.stack((a,b), axis=0).shape
(2, 3)
>>> np.stack((a,b), axis=1)
array([[1, 4],
       [2, 5],
       [3, 6]])
>>> np.stack((a,b), axis=1).shape
(3, 2)
```

[1，2，3]和[4，5，6]在axis=0轴上连接后得到新序列形状为shape=(2, 3)。新序列的形状2，3中，2表示两个序列连接，而且是在0轴位置上。

```
>>> a=np.arange(12).reshape(3,4)
>>> b=np.arange(12).reshape(3,4)+1
>>> a
array([[ 0,  1,  2,  3],
       [ 4,  5,  6,  7],
       [ 8,  9, 10, 11]])
>>> b
array([[ 1,  2,  3,  4],
       [ 5,  6,  7,  8],
       [ 9, 10, 11, 12]])
>>> np.stack((a,b))
array([[[ 0,  1,  2,  3],
        [ 4,  5,  6,  7],
        [ 8,  9, 10, 11]],

       [[ 1,  2,  3,  4],
        [ 5,  6,  7,  8],
        [ 9, 10, 11, 12]]])
>>> np.stack((a,b)).shape
(2, 3, 4)
>>> np.stack((a,b), axis=1)
array([[[ 0,  1,  2,  3],
        [ 1,  2,  3,  4]],

       [[ 4,  5,  6,  7],
        [ 5,  6,  7,  8]],

       [[ 8,  9, 10, 11],
        [ 9, 10, 11, 12]]])
>>> np.stack((a,b), axis=1).shape
(3, 2, 4)
>>> np.stack((a,b), axis=2)
array([[[ 0,  1],
        [ 1,  2],
        [ 2,  3],
        [ 3,  4]],

       [[ 4,  5],
        [ 5,  6],
        [ 6,  7],
        [ 7,  8]],

       [[ 8,  9],
        [ 9, 10],
        [10, 11],
        [11, 12]]])
>>> np.stack((a,b), axis=2).shape
(3, 4, 2)
```

## 原理

```
>>> a
array([[ 0,  1,  2,  3],
       [ 4,  5,  6,  7],
       [ 8,  9, 10, 11]])
>>> b
array([[ 1,  2,  3,  4],
       [ 5,  6,  7,  8],
       [ 9, 10, 11, 12]])
```

### 合并前

a各元素的下标：

```
(0, 0) (0, 1) (0, 2) (0, 3)
(1, 0) (1, 1) (1, 2) (1, 3)
(2, 0) (2, 1) (2, 2) (2, 3)
```

b各元素的下标：

```
(0, 0) (0, 1) (0, 2) (0, 3)
(1, 0) (1, 1) (1, 2) (1, 3)
(2, 0) (2, 1) (2, 2) (2, 3)
```

### 合并

numpy.stack((a, b), axis=1)在轴axis=1处合并时，
a各元素的下标：

```
(0, `0`, 0) (0, `0`, 1) (0, `0`, 2) (0, `0`, 3)
(1, `0`, 0) (1, `0`, 1) (1, `0`, 2) (1, `0`, 3)
(2, `0`, 0) (2, `0`, 1) (2, `0`, 2) (2, `0`, 3)
```

b各元素的下标：

```
(0, `1`, 0) (0, `1`, 1) (0, `1`, 2) (0, `1`, 3)
(1, `1`, 0) (1, `1`, 1) (1, `1`, 2) (1, `1`, 3)
(2, `1`, 0) (2, `1`, 1) (2, `1`, 2) (2, `1`, 3)
```

### 合并后

合并之后，先排满axis=0位置，然后排axis=1位置0->1：

```
(0, `0`, 0) (0, `0`, 1) (0, `0`, 2) (0, `0`, 3)
(0, `1`, 0) (0, `1`, 1) (0, `1`, 2) (0, `1`, 3)
(1, `0`, 0) (1, `0`, 1) (1, `0`, 2) (1, `0`, 3)
(1, `1`, 0) (1, `1`, 1) (1, `1`, 2) (1, `1`, 3)
(2, `0`, 0) (2, `0`, 1) (2, `0`, 2) (2, `0`, 3)
(2, `1`, 0) (2, `1`, 1) (2, `1`, 2) (2, `1`, 3)
```

# Reference

https://blog.csdn.net/qq_17550379/article/details/78934529